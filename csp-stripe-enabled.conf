# CSP Configuration with Stripe Support
# Add to nginx server block or as a separate include

add_header Content-Security-Policy "default-src 'self';
script-src 'self' https://js.stripe.com https://plausible.io https://cdn.jsdelivr.net https://cdn.tailwindcss.com 'unsafe-inline';
connect-src 'self' https://metrics.macagent.pro wss://metrics.macagent.pro https://plausible.io https://api.stripe.com https://checkout.stripe.com;
img-src 'self' data: blob: https://q.stripe.com https://b.stripecdn.com;
frame-src https://js.stripe.com https://checkout.stripe.com;
style-src 'self' 'unsafe-inline';
frame-ancestors 'none'; 
upgrade-insecure-requests;" always;

# HSTS + OCSP stapling for production security
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
ssl_stapling on; 
ssl_stapling_verify on;