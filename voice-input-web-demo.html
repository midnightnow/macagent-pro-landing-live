<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MacAgent Pro - Voice Input Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .recording { animation: pulse 1.5s ease-in-out infinite alternate; }
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div class="min-h-screen flex items-center justify-center p-6">
        <div class="max-w-2xl w-full">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold mb-4">üé§ MacAgent Pro Voice Input</h1>
                <p class="text-xl text-gray-300">Test the "Hey MacAgent" voice activation feature</p>
            </div>

            <!-- Voice Input Interface -->
            <div class="bg-gray-800 rounded-2xl p-8 mb-6">
                <div class="text-center mb-6">
                    <div id="micIcon" class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 cursor-pointer hover:bg-blue-500 transition-colors" onclick="toggleRecording()">
                        <span class="text-3xl">üé§</span>
                    </div>
                    <div id="status" class="text-lg font-medium text-gray-300">Click microphone to start</div>
                </div>

                <!-- Voice Command Examples -->
                <div class="grid md:grid-cols-2 gap-4 mb-6">
                    <button onclick="simulateCommand('Hey MacAgent, check my temperature')" class="bg-green-600 hover:bg-green-500 p-3 rounded-lg text-left">
                        <div class="font-mono text-sm">"Hey MacAgent, check my temperature"</div>
                    </button>
                    <button onclick="simulateCommand('MacAgent, optimize my Mac')" class="bg-blue-600 hover:bg-blue-500 p-3 rounded-lg text-left">
                        <div class="font-mono text-sm">"MacAgent, optimize my Mac"</div>
                    </button>
                    <button onclick="simulateCommand('Hey Mac, how much memory am I using?')" class="bg-purple-600 hover:bg-purple-500 p-3 rounded-lg text-left">
                        <div class="font-mono text-sm">"Hey Mac, how much memory am I using?"</div>
                    </button>
                    <button onclick="simulateCommand('MacAgent, help me free up storage')" class="bg-orange-600 hover:bg-orange-500 p-3 rounded-lg text-left">
                        <div class="font-mono text-sm">"MacAgent, help me free up storage"</div>
                    </button>
                </div>

                <!-- Transcript Display -->
                <div class="bg-gray-700 rounded-lg p-4 mb-4">
                    <div class="text-sm text-gray-400 mb-2">Voice Input Transcript:</div>
                    <div id="transcript" class="font-mono text-green-400">Waiting for voice input...</div>
                </div>

                <!-- Response Display -->
                <div class="bg-gray-700 rounded-lg p-4">
                    <div class="text-sm text-gray-400 mb-2">MacAgent Response:</div>
                    <div id="response" class="font-mono text-blue-400">Ready to assist with voice commands</div>
                </div>
            </div>

            <!-- Status Info -->
            <div class="bg-gray-800 rounded-lg p-4">
                <div class="flex items-center gap-3">
                    <div id="statusDot" class="w-3 h-3 bg-gray-500 rounded-full"></div>
                    <span id="statusText" class="text-sm">Voice recognition not started</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let recognition = null;
        let isRecording = false;
        const wakeWords = ['hey macagent', 'macagent', 'hey mac'];

        function initSpeechRecognition() {
            if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onstart = function() {
                    updateStatus('Listening for "Hey MacAgent"...', 'green', true);
                    document.getElementById('micIcon').classList.add('recording');
                };

                recognition.onresult = function(event) {
                    let finalTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; ++i) {
                        if (event.results[i].isFinal) {
                            finalTranscript += event.results[i][0].transcript;
                        }
                    }
                    
                    if (finalTranscript) {
                        document.getElementById('transcript').textContent = finalTranscript;
                        processVoiceCommand(finalTranscript.toLowerCase().trim());
                    }
                };

                recognition.onerror = function(event) {
                    updateStatus(`Error: ${event.error}`, 'red', false);
                    document.getElementById('micIcon').classList.remove('recording');
                };

                recognition.onend = function() {
                    if (isRecording) {
                        // Restart recognition to keep listening
                        setTimeout(() => recognition.start(), 100);
                    } else {
                        updateStatus('Voice recognition stopped', 'gray', false);
                        document.getElementById('micIcon').classList.remove('recording');
                    }
                };

                return true;
            } else {
                updateStatus('Speech recognition not supported in this browser', 'red', false);
                return false;
            }
        }

        function toggleRecording() {
            if (!recognition && !initSpeechRecognition()) {
                return;
            }

            if (isRecording) {
                isRecording = false;
                recognition.stop();
                updateStatus('Stopping voice recognition...', 'orange', false);
            } else {
                isRecording = true;
                try {
                    recognition.start();
                } catch (error) {
                    updateStatus('Failed to start voice recognition', 'red', false);
                    isRecording = false;
                }
            }
        }

        function updateStatus(text, color, isActive) {
            const statusText = document.getElementById('statusText');
            const statusDot = document.getElementById('statusDot');
            const status = document.getElementById('status');
            
            statusText.textContent = text;
            status.textContent = text;
            
            // Update dot color
            statusDot.className = `w-3 h-3 rounded-full ${
                color === 'green' ? 'bg-green-500' :
                color === 'red' ? 'bg-red-500' :
                color === 'orange' ? 'bg-orange-500' :
                'bg-gray-500'
            }`;

            if (isActive) {
                statusDot.classList.add('animate-pulse');
            } else {
                statusDot.classList.remove('animate-pulse');
            }
        }

        function processVoiceCommand(transcript) {
            console.log('Processing:', transcript);
            
            // Check for wake words
            const hasWakeWord = wakeWords.some(word => transcript.includes(word));
            
            if (hasWakeWord) {
                // Extract command after wake word
                let command = transcript;
                for (const wakeWord of wakeWords) {
                    if (transcript.includes(wakeWord)) {
                        command = transcript.substring(transcript.indexOf(wakeWord) + wakeWord.length).trim();
                        break;
                    }
                }
                
                updateStatus(`‚úÖ Wake word detected! Processing: "${command}"`, 'green', true);
                setTimeout(() => generateResponse(command), 1000);
            } else {
                updateStatus('Listening for "Hey MacAgent"...', 'green', true);
            }
        }

        function generateResponse(command) {
            let response = '';
            
            if (command.includes('temperature') || command.includes('hot') || command.includes('thermal')) {
                response = 'üå°Ô∏è CPU Temperature: 67.2¬∞C - That\'s getting a bit warm but still okay. GPU: 45.3¬∞C. Consider closing some apps if it gets hotter.';
            } else if (command.includes('optimize') || command.includes('speed up') || command.includes('performance')) {
                response = 'üöÄ Running Mac optimization now... Clearing caches, optimizing memory, updating system processes... Complete! Your Mac should feel snappier now.';
            } else if (command.includes('memory') || command.includes('ram')) {
                response = 'üß† Memory Usage: 12.8GB / 16GB (80% used). Active apps using most memory: Chrome (2.1GB), Photoshop (1.8GB), Slack (743MB). Would you like me to optimize memory usage?';
            } else if (command.includes('storage') || command.includes('disk') || command.includes('space')) {
                response = 'üíæ Storage Analysis: 234GB used / 512GB total (46%). Found 8.3GB of cache files that can be safely deleted. Downloads folder: 12.1GB. Would you like me to clean up storage?';
            } else if (command.includes('help')) {
                response = 'ü§ñ I can help with: temperature monitoring, Mac optimization, memory analysis, storage cleanup, and system diagnostics. Just say "Hey MacAgent" followed by what you need!';
            } else {
                response = `ü§ñ I heard "${command}". I\'m still learning how to handle that request, but I\'m getting smarter every day! Try asking about temperature, optimization, memory, or storage.`;
            }
            
            document.getElementById('response').textContent = response;
            
            // Speak the response if speech synthesis is available
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(response);
                utterance.rate = 0.9;
                utterance.pitch = 1;
                speechSynthesis.speak(utterance);
            }
            
            updateStatus('Response generated - Listening for next command...', 'green', true);
        }

        function simulateCommand(command) {
            document.getElementById('transcript').textContent = command;
            processVoiceCommand(command.toLowerCase());
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('Click microphone to start voice recognition', 'gray', false);
        });
    </script>
</body>
</html>